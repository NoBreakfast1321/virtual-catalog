<%# locals: (catalog:, product:) %>

<%= errable_form_with model: [catalog, product], multipart: true, class: "form" do |form| %>
  <div class="form__group form__group--inline">
    <%= form.checkbox :adult_only, class: "form__checkbox" %>
    <%= form.label :adult_only, class: "form__label" %>
    <%= form.error :adult_only, "form__error" %>
  </div>

  <div class="form__group">
    <%= form.label :available_from, class: "form__label" %>
    <%= form.datetime_local_field :available_from, class: "form__input" %>
    <%= form.error :available_from, "form__error" %>
  </div>

  <div class="form__group">
    <%= form.label :available_until, class: "form__label" %>
    <%= form.datetime_local_field :available_until, class: "form__input" %>
    <%= form.error :available_until, "form__error" %>
  </div>

  <div class="form__group">
    <%= form.label :code, class: "form__label" %>
    <%= form.text_field :code, class: "form__input" %>
    <%= form.error :code, "form__error" %>
  </div>

  <div class="form__group">
    <%= form.label :description, class: "form__label" %>
    <%= form.text_area :description, class: "form__input" %>
    <%= form.error :description, "form__error" %>
  </div>

  <div class="form__group form__group--inline">
    <%= form.checkbox :featured, class: "form__checkbox" %>
    <%= form.label :featured, class: "form__label" %>
    <%= form.error :featured, "form__error" %>
  </div>

  <div class="form__group">
    <%= form.label :name, class: "form__label" %>
    <%= form.text_field :name, class: "form__input" %>
    <%= form.error :name, "form__error" %>
  </div>

  <div
    data-controller="currency"
    data-currency-currency-value="<%= Money.default_currency.iso_code %>"
    data-currency-locale-value="<%= I18n.locale %>"
    class="form__group"
  >
    <%= form.label :price, class: "form__label" %>
    <%= form.hidden_field :price,
                      id: nil,
                      data: {
                        "currency-target": "hidden",
                      },
                      value: (product.base_variant&.price_cents || 0) / 100.0 %>

    <input
      id="product_price"
      data-currency-target="input"
      data-action="currency#format"
      inputmode="numeric"
      class="form__input"
    />

    <%= form.error :price, "form__error" %>
  </div>

  <div class="form__group form__group--inline">
    <%= form.checkbox :visible, class: "form__checkbox" %>
    <%= form.label :visible, class: "form__label" %>
    <%= form.error :visible, "form__error" %>
  </div>

  <div class="form__group">
    <%= form.label :category_ids, "Categories", class: "form__label" %>
    <%= form.collection_select :category_ids,
                           catalog.categories,
                           :id,
                           :name,
                           {},
                           multiple: true,
                           class: "form__input" %>

    <%= form.error :category_ids, "form__error" %>
  </div>

  <footer class="form__footer">
    <%= link_to "Cancel",
            (
              if product.persisted?
                [catalog, product]
              else
                catalog_products_path(catalog)
              end
            ),
            class: "button" %>

    <%= form.submit "Save", class: "button button--action" %>
  </footer>
<% end %>
